<style>
    #target {
        overflow: auto;
    }

    #target2 {
        overflow: auto;
    }

    textarea {
        resize: vertical;
    }

    /* Rating Star Widgets Style */
    .rating-stars ul {
        list-style-type: none;
        padding: 0;

        -moz-user-select: none;
        -webkit-user-select: none;
    }

    .rating-stars ul>li.star {
        display: inline-block;

    }

    /* Idle State of the stars */
    .rating-stars ul>li.star>i.fa {
        font-size: 2.5em;
        /* Change the size of the stars */
        color: #ffffff;
        /* Color on idle state */
    }

    /* Hover state of the stars */
    .rating-stars ul>li.star.hover>i.fa {
        color: #FFCC36;
    }

    /* Selected state of the stars */
    .rating-stars ul>li.star.selected>i.fa {
        color: #FF912C;
    }
</style>

<body>
    <!--Panel Tool-->
    <div class="center-align panelTool">
        <!-- à¸ºBasic -->
        <div class="noselect source sourceHeader activeSource" type="basic" style="background-color:#FF9D00;">
            Operator</div>
        <div id="source" class="connectedSource source sourcePanel activeSource noselect" type="basic">
            Statate
        </div>

        <!-- Question Area -->
        <div id="target" class="center-align connectedSource noselect targetPanel ui-widget-content"
            style="width: 50%;">
            <div style="padding: 0px 20px 20px 20px;text-align: left;">
                <p style="text-align: center;font-size: 20px;font-weight: bold;">Pesudo</p>
                <button style="text-align: left;font-size: 18px;font-weight: bold;" onclick="addProcess()">+
                    Process</button>
                <button style="text-align: left;font-size: 18px;font-weight: bold;" onclick="removeProcess()">-
                    Process</button>
            </div>
            <div style="padding: 0px 20px 20px 20px;text-align: left;" id="statement">
                <table id="myTable">
                    <thead>
                        <tr>
                            <td style="width: 10%;">Step</td>
                            <td style="text-align: center;width: 70%;">Process</td>
                            <td style="text-align: center;width: 20%;">Type</td>
                        </tr>
                    </thead>
                    <tbody id="st1">
                        <tr id="st2">
                            <td>1</td>
                            <td><input type="text" style="background-color: white;" value="Start" id="process_1"
                                    disabled></td>
                            <td><input type="text" style="background-color: white;" value="Start" id="type_1" disabled>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div style="padding: 0px 20px 20px 20px;text-align: left;" id="statement_add">

            </div>
        </div>
        <div id="question" class="center-align connectedSource noselect targetPanel ui-widget-content"
            style="width: 25%;margin-left: 51%;" id="div1">
            <div style="padding: 0px 20px 20px 20px;">
                <p style="text-align: left;font-size: 18px;font-weight: bold;">Question Name</p>
                <input id="questionInput" type="text" style="background-color: white;" />
                <p style="text-align: left;font-size: 18px;font-weight: bold;">Hint</p>
                <textarea id="hintInput" style="background-color: white;height: 240px;"></textarea>
                <p style="text-align: left;font-size: 18px;font-weight: bold;">Difficult</p>
                <!-- Rating Stars Box -->
                <section class='rating-widget'>
                    <div class='rating-stars' style="text-align: left;">
                        <ul id='stars'>
                            <li class='star' title='Poor' data-value='1'>
                                <i class='fa fa-star fa-fw'></i>
                            </li>
                            <li class='star' title='Fair' data-value='2'>
                                <i class='fa fa-star fa-fw'></i>
                            </li>
                            <li class='star' title='Good' data-value='3'>
                                <i class='fa fa-star fa-fw'></i>
                            </li>
                            <li class='star' title='Excellent' data-value='4'>
                                <i class='fa fa-star fa-fw'></i>
                            </li>
                            <li class='star' title='WOW!!!' data-value='5'>
                                <i class='fa fa-star fa-fw'></i>
                            </li>
                        </ul>
                    </div>
                    <div>
                        <input type="text" id="ratingStar" value="0" hidden>
                    </div>
                    <div class='success-box'>
                        <div class='clearfix'></div>
                        <div class='text-message'></div>
                        <div class='clearfix'></div>
                    </div>
                </section>
            </div>
        </div>
    </div>
    <!--Menu Icon-->
    <ul class="tabs">
        <li style="height: 80px;" class="tab">
            <div id="saveButton" class="canClick jellyButton button-tool">
                <div class="save-icon"></div>
            </div>
        </li>
        <li style="height: 90px;" class="tab">
            <div id="cancelButton" class="canClick jellyButton button-tool">
                <div class="cancel-icon"></div>
            </div>
        </li>

    </ul>
</body>

<div id="modal-input" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            Input text
        </div>
        <input type="text" id="input-test" value="">
    </div>
    <div class="modal-footer">

        <button class="modal-button button-element" style="float:right" onclick="save_text()">Save</button>
    </div>
</div>

<script>

    $(document).ready(function () {

        /* 1. Visualizing things on Hover - See next part for action on click */
        $('#stars li').on('mouseover', function () {
            var onStar = parseInt($(this).data('value'), 10); // The star currently mouse on

            // Now highlight all the stars that's not after the current hovered star
            $(this).parent().children('li.star').each(function (e) {
                if (e < onStar) {
                    $(this).addClass('hover');
                }
                else {
                    $(this).removeClass('hover');
                }
            });

        }).on('mouseout', function () {
            $(this).parent().children('li.star').each(function (e) {
                $(this).removeClass('hover');
            });
        });


        /* 2. Action to perform on click */
        $('#stars li').on('click', function () {
            var onStar = parseInt($(this).data('value'), 10); // The star currently selected
            var stars = $(this).parent().children('li.star');

            for (i = 0; i < stars.length; i++) {
                $(stars[i]).removeClass('selected');
            }

            for (i = 0; i < onStar; i++) {
                $(stars[i]).addClass('selected');
            }

            // JUST RESPONSE (Not needed)
            var ratingValue = parseInt($('#stars li.selected').last().data('value'), 10);
            document.getElementById("ratingStar").value = ratingValue;
            console.log(ratingValue);
        });

    });

    var index = 1;
    // Add Process in flowchart
    function addProcess() {
        index++;
        var table = document.getElementById("myTable");
        var row = table.insertRow(index);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        cell1.innerHTML = index;
        cell2.innerHTML = "<input type='text' style='background-color: white;' id='process_" + index + "'>";
        cell3.innerHTML = "<input type='text' style='background-color: white;' id='type_" + index + "'>";
    }
    // Remove Process in flowchart
    function removeProcess() {
        console.log("Delete", index);
        var table = document.getElementById("myTable");
        //var row;
        if (index > 1) {
            table.deleteRow(index);
            index--;
        }
    }

    $('#saveButton').click(function () {
        let dataDiagram = [];
        let data;
        let logicName = $("#questionInput").val();
        let logicHint = $("#hintInput").val();
        let logicLevel = document.getElementById("ratingStar").value;
        for (let i = 1; i <= index; i++) {
            data = { process: document.getElementById("process_" + i).value, type: document.getElementById("type_" + i).value, sequence: i };
            dataDiagram.push(data);
        }
        /*console.log("Diagram", dataDiagram);
        console.log("Name", logicName);
        console.log("Hint", logicHint);
        console.log("Star", logicLevel);*/
        saveQuestion(dataDiagram, logicName, logicHint, logicLevel)
    });

    let refQuestion = firestore.collection("Diagram");
    let keyId = 0;
    //save data to firebase 
    function saveQuestion(dataDiagram, logicName, logicHint, logicLevel) {
        /*console.log("save...");
        console.log("Diagram", dataDiagram);
        console.log("Name", logicName);
        console.log("Hint", logicHint);
        console.log("Star", logicLevel);*/
        
        refQuestion.get().then(function (doc) {
            keyId = doc.size + 1;
            console.log("set("+keyId+")");
        }).then(function () {
            refQuestion.doc(keyId.toString()).set({
                Name: logicName,
                Hint: logicHint,
                Level: logicLevel,
                answer: dataDiagram
            }).then(function () {
                showSaveStatus("Save Success!!");
            }).catch(err => {
                showSaveStatus("Error : " + err);
            });
        });
    }
</script>